# re2-cpp-is-awesome

[题目地址](https://adworld.xctf.org.cn/challenges/details?hash=c3014f87-1f96-419c-ab3b-e4709a26629e_2)

这道题的介绍提到了C++，而且我一点也不懂C++，不过还是勉强做出来了。归功于Ghidra的误打误撞，反汇编伪代码永远都是C语言。

首先运行一下附件。

- $ ./5d6da120dfe6499884ac53ef9fe3c80f 
- > Usage: ./5d6da120dfe6499884ac53ef9fe3c80f flag
- $ ./5d6da120dfe6499884ac53ef9fe3c80f flag
- > Better luck next time

可以尝试在Ghidra中搜索“luck”或者“Usage”等字符串找到入口点。

![entry](https://github.com/C0nstellati0n/NoobCTF/blob/main/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/images/entryPoint.png)

又是一堆命名非常迷惑人的函数。这些函数我也一个一个点进去看了，啥用没有，里面都是调用一个叫“HaltBadData()"的函数，而HaltBadData()没有任何显示。可能是Ghidra在反编译时的错误。

那么跳过一堆混乱的函数后，我们来到了关键的while循环。扫一眼可以注意到有个叫“PTR_s_L3t_ME_T3ll_Y0u_S0m3th1ng_1mp0rt_006020a0”的东西。既然它自己都说这是"Something important"了，那我们就直接进去看看。

- L3t_ME_T3ll_Y0u_S0m3th1ng_1mp0rtant_A_{FL4G}_W0nt_b3_3X4ctly_th4t_345y_t0_c4ptur3_H0wev3r_1T_w1ll_b3_C00l_

是一个字符串。把字符串提取出来后接着往下看。如果“\*pcVar4“的值不等于上面那个字符串*(int *)(&DAT_006020c0 + (long)local_1c * 4)]的索引值,就调用Fail(),而这不是我们想要的。我们的目标是跳出while循环并调用后面的Win()。先看看DAT_006020c0里面是什么。

- 24 00 00 00 00 00 00 00 05 00 00 00 36 00 00 00 65 00 00 00 07 00 00 00 27 00 00 00 26 00 00 00 2d 00 00 00 01 00 00 00 03 00 00 00 00 00 00 00 0d 00 00 00 56 00 00 00 01 00 00 00 03 00 00 00 65 00 00 00 03 00 00 00 2d 00 00 00 16 00 00 00 02 00 00 00 15 00 00 00 03 00 00 00 65 00 00 00 00 00 00 00 29 00 00 00 44 00 00 00 44 00 00 00 01 00 00 00 44 00 00 00 2b 00 00 00

看来这是一个byte数组，应该也和flag有关。后面的local_1c * 4就很简单了，初始值是0，每次循环都加一，所以它的值是0，4，8，12……结合DAT_006020c0也可以发现，每4位都有一个非00数据。&DAT_006020c0取出的是这个数组的首地址，其值和首元素的地址相同但是意义不同。\*(int \*)先用(int \*)将后面的内容进行强制类型转换，再用\*取出转换后地址的值。由于这里数组里元素的地址都是挨着的，所以这一串东西就可以简化理解为DAT_006020c0\[4*n],n开始等于0。

最后的问题是怎么跳出while循环。跳出循环的条件是cVar1 == 0，而cVar1由FUN_00400d3d()得来。但是里面的内容我无法逆向，况且按照上面的逻辑似乎已经可以得到flag了。所以直接着手写脚本。

```python
data='24 00 00 00 00 00 00 00 05 00 00 00 36 00 00 00 65 00 00 00 07 00 00 00 27 00 00 00 26 00 00 00 2d 00 00 00 01 00 00 00 03 00 00 00 00 00 00 00 0d 00 00 00 56 00 00 00 01 00 00 00 03 00 00 00 65 00 00 00 03 00 00 00 2d 00 00 00 16 00 00 00 02 00 00 00 15 00 00 00 03 00 00 00 65 00 00 00 00 00 00 00 29 00 00 00 44 00 00 00 44 00 00 00 01 00 00 00 44 00 00 00 2b 00 00 00'
s='L3t_ME_T3ll_Y0u_S0m3th1ng_1mp0rtant_A_{FL4G}_W0nt_b3_3X4ctly_th4t_345y_t0_c4ptur3_H0wev3r_1T_w1ll_b3_C00l_'
data=data.split(' ')
for i in range(0,len(data),4):
    index=int(data[i],16)
    print(s[index:index+1],end='')
```

- ### Flag
- > ALEXCTF{W3_L0v3_C_W1th_CL45535}
