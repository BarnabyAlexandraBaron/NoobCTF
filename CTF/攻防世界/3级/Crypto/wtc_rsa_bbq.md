# wtc_rsa_bbq

[题目地址](https://adworld.xctf.org.cn/challenges/details?hash=42a6302c-7e05-4533-bbaf-783952147096_2)

RSA三杀。这里附件包含公钥和密文。cat公钥差点让我觉得我电脑显示出错了。

- -----BEGIN PUBLIC KEY-----<br>
MIIEUzANBgkqhkiG9w0BAQEFAAOCBEAAMIIEOwKCBDIGLT1hySRSYwFH6JZw////<br>
////////////////////////////////////////////////////////////////<br>
////////////////////////////////////////////////////////////////<br>
////////////////////////////////////////////////////////////////<br>
////////////////////////////////////////////////////////////////<br>
////////////////////////////////////////////////////////////////<br>
////////////////////////////////////////////////////////////////<br>
////////////////////////////////////////////////////////////////<br>
////////////////////////////////////////////////////////////////<br>
////////////////////////////////////////////////////////////////<br>
////////////////////////////////////////////////////////////////<br>
////////////////////////////////////////////////////////////////<br>
////////////////////////////////////////////////////////////////<br>
////////////////////////////////////////////////////////////////<br>
////////////////////////////////////////////////////////////////<br>
////////////////////////////////////////////////////////////////<br>
////////////////////////////////////////////////////////////////<br>
////////////////////////////////////////////////////////////////<br>
////////////////////////////////////////////////////////////////<br>
////////////////////////////////////////////////////////////////<br>
////////////////////////////////////////////////////////////////<br>
////////////////////////////////////////////////////////////////<br>
////////////////////////////////////////////////////////////////<br>
//8CAwEAAQ==<br>
-----END PUBLIC KEY-----<br>

这一堆斜线看着我眼花，但是看其他字母又像是没有啥问题的base64编码。突然想到base64其实也可以有斜线，所以读取一下这个公钥试试。

- n:67957992944541709079637331495835288051017736172946219268979124310219676901814634141994056910249665182493729973853745613557654443204907939100289830019879722192443748372464385547701814777428863933615522890059773474417386931884425569247554583568455670977507333610910984675277207738543785144821532814109666026143830882670492412501367418900259525020329476259602896533289977520877332000639367622359213599508853567838502735818733930199768810238363613613753812700686852922490193705926713608040249887743216661319134457665231243871456616938275370046526015614319970725259025037328092187037543179610573655207460380491069632574369131778109901652462838149658009709174356861767870204803806924289315954871595222073859185353284268587331267173728221658781990119401252167899826047588583247362298572788397512447184590473718761927222549389515152849248566281272354480116085470203137413924993107429630882329043259530840382880179158766903387472716587067982240678129096467201138461960380680792953534366991098348930562736587887507018304132204828793333486018470656056870548645765390879310100168147762901154890481163444481122296433539288905754638768700952492512406731460604412447424967642115057341729310735982961515248311488333222612609961196477124084039771246638999119951171033639602489932159455170406551791127198312487436473494597495007637073871513066738388720194946877125132719068351961085662002556667562192631487439603084021927891681500086528284664252971146275389474911554158614058033716200975019522317823518017673425098559715637356338155079086810436188632405309750833509905138561418180066417475648209078560221064551872389391920606516486209161430247427717376721027499023891011742164463421915449354247944433039198608877315066424065203739793333831943021283319660097829517280179002430376294322395829290502762707146363340431306946572116838111246133390539315819023086956548363452657425340012155573512351731935196011505710069798425307656340650313899667019621505845424588367900827398564048322933092059258373872118350187669748998950161402077367239291462315563970921983573721268515566367155707585109243757143789901450148994239501684623655163637997105769222959494325064113278738038394139099703042640054592379346782002980751786063951491138135071807202634411442713870047730189971333170418112077390015852729766594918955255488280027359348811304774349052504612270369695008061623968574970758347117606577939555446238067430685787886502742201372798852010893885999941946548336103402517187248492765699490151394806591149028320530966365733320484047650429644420042692902092613911608152310152409036167526533619822851411589502970363903

- e:65537

这么大的n看来没法暴力分解了。e也没啥问题。不过当你把n转成16进制是你会发现有很多f。其实背后的原理我不知道是啥，我也没有搜到，但是这种特征就表明p和q可能是相隔很近的质数，用费马分解可以很快得出答案。

```python
from Crypto.PublicKey import RSA
from Crypto.Util.number import *
import gmpy2
c=bytes_to_long(open('你的密文地址','rb').read())
key=RSA.importKey(open('你的公钥地址').read())
n,e=key.n,key.e
s=gmpy2.iroot(n+1,2)[0]
p=s-1
q=s+1
d=inverse(e,(p-1)*(q-1))
print(long_to_bytes(pow(c,d,n)))
```

这个writeup非我原创，在这道题的writeup区可以看到。可是为啥要这么写呢？那个大佬的writeup写得有点不太清楚，我数学也不好，只能模糊地解释一下。

首先这里确实是使用了费马分解，但是是一种特殊的情况。

- ### 费马分解
- > 对于任意一个奇数n，n = ab = x^2-y^2。x^2-y^2=\(x+y)*\(x-y),因此a=x+y,b=x-y,x=\(a+b)\2,y=(a-b)\2。因为n为奇数，a, b必也为奇数，所以(a+b)和(a-b)必为偶数，故都能被2整除。x, y为整数，x > y

所以根据 s=gmpy2.iroot(n+1,2)\[0] 可以知道模数n对应上面公式的n，q和p分别为上面公式的a和b，s对应着公式的x，1对应着公式的y。这里一次就成功了是一种巧合，因为正常来说是要重复以下步骤的：

- y^2=x^2-n<br>x^2-n>=y^2>=0<br>x^2>=n<br>x>=sqrt(n)
- 从x = sqrt(n)开始，计算x^2 – n为完全平方数即可求出x, y，然后求得a, b

当然你也可以表达成x^2=y^2+n，也就是上面的python脚本所使用的。不过这里一次就成也不用考虑太多了。相信我在数学基础不行和做的题太少的情况下不要强行死想一个东西，想一次做好，因为这样反而会钻到死胡同。

- ### Flag
- > flag{how_d0_you_7urn_this_0n?}

