# [AFCTF2018]花开藏宝地

[题目地址](https://buuoj.cn/challenges#[AFCTF2018]%E8%8A%B1%E5%BC%80%E8%97%8F%E5%AE%9D%E5%9C%B0)

```
第80804238007977405688648566160504278593148666302626415149704905628622876270862865768337953835725801963142685182510812938072115996355782396318303927020705623120652014080032809421180400984242061592520733710243483947230962631945045134540159517488288781666622635328316972979183761952842010806304748313326215619695085380586052550443025074501971925005072999275628549710915357400946408857号藏宝图

我把我的宝藏都藏在了那里！
那个神秘的地方！
于是我把藏宝图分成了5份，交给五位贤者让他们帮我妥善保管，并且只要搜集3份就可以获得宝藏的地址。

第一位贤者将藏宝图放进时空门中说道：
“那么口令就是我的生日吧，那可是个好数字呢。”

第二位贤者将藏宝图放进宝箱，【小】声念着自己的名字锁上了宝箱。

第三位贤者将藏宝图施上咒语丢进大海：“只要【大】声喊出那句咒语就可以把水驱逐！”

第四位贤者找了个破锁锁上了宝箱，狡黠地笑着：“谁知道它是坏的呢？”

第五位贤者给藏宝图裹上了隐身衣，放入了一个匣子里

据说，只有拥有【智慧】与【力量】就可以获得宝藏了呢！~
你是这样的勇者吗？
```

题目给了5个压缩包以及一个描述。根据描述可知第4个压缩包是伪加密，第5个压缩包是NTFS流隐写，用winrar+NTFS StreamEditor即可获取。第一个压缩包爆破生日，第二个压缩包爆破小写字母，第三个压缩包爆破大写字母。不过题目说我们只需要3个，随便拿3组就好了。但是我不知道这是个啥加密，只能去看[wp](https://blog.csdn.net/qq_51999772/article/details/121422999)。获知是[秘密共享](https://webencrypt.org/secretsharing/#bloom)（secret sharing），题目名的“花开”指的是Asmuth-Bloom方案。wp给的加密及解密解析都很详细和简单，对于我这个菜狗来说感觉比网站写的好，不过更多参数选取的限制还要看网站补充。总之我们得到的数据是模数和余数，三组就能构建下面的同余方程组：

$x\equiv y_1\mod m_1$<br>
$x\equiv y_2\mod m_2$<br>
$x\equiv y_3\mod m_3$

其中x=S+A\*p，p是第xxx号藏宝图的内容，S是明文，A是随便选的一个满足 $0\leq A\leq [N/p]-1$ 的数。然而这题没有A。不过Asmuth-Bloom方案的参数选取有一个条件，选取的p是一个大质数且大于S。那就能把x=S+A\*p写为同余形式：

$x\equiv S\mod p$

也就是说x直接模p就得到S了。这题不知道为啥sympy的crt函数用不了，只能自己解。

```python
from Crypto.Util.number import inverse,long_to_bytes
y1 = 305345133911395218573790903508296238659147802274031796643017539011648802808763162902335644195648525375518941848430114497150082025133000033835083076541927530829557051524161069423494451667848236452337271862085346869364976989047180532167560796470067549915390773271207901537847213882479997325575278672917648417868759077150999044891099206133296336190476413164240995177077671480352739572539631359
m1 = 347051559622463144539669950096658163425646411435797691973701513725701575100810446175849424000000075855070430240507732735393411493866540572679626172742301366146501862670272443070970511943485865887494229487420503750457974262802053722093905126235340380261828593508455621667309946361705530667957484731929151875527489478449361198648310684702574627199321092927111137398333029697068474762820813413
y2 = 152012681270682340051690627924586232702552460810030322267827401771304907469802591861912921281833890613186317787813611372838066924894691892444503039545946728621696590087591246339208248647926966446848123290344911662916758039134817404720512465817867255277476717353439505243247568126193361558042940352204093381260402400739429050280526212446967632582771424597203000629197487733610187359662268583
m2 = 347051559622463144539669950096658163425646411435797691973701513725701575100810446175849424000000075855070430240507732735393411493866540572679626172742301366146501862670272443070970511943485865887494229487420503750457974262802053722093905126235340380261828593508455621667309946361705530667957484731929151875527489478449361198648310684702574627199321092927111137398333029697068474762820818553
y3 = 40952412095267791829743119118333311932687870987919948671780408726886151430242690997238831410249436653299224291445012397813221016909468630372862610415470277301591535416193017906909638241212666990959976187895288689640250810487806568164431359887246760313154046201720715301307811951233077581047872827004824833876458687145628724339714212107812941785880896399800008924818580623979723496070665230
m3 = 347051559622463144539669950096658163425646411435797691973701513725701575100810446175849424000000075855070430240507732735393411493866540572679626172742301366146501862670272443070970511943485865887494229487420503750457974262802053722093905126235340380261828593508455621667309946361705530667957484731929151875527489478449361198648310684702574627199321092927111137398333029697068474762820819351
p = 80804238007977405688648566160504278593148666302626415149704905628622876270862865768337953835725801963142685182510812938072115996355782396318303927020705623120652014080032809421180400984242061592520733710243483947230962631945045134540159517488288781666622635328316972979183761952842010806304748313326215619695085380586052550443025074501971925005072999275628549710915357400946408857
mods=[m1,m2,m3]
y=[y1,y2,y3]
inv_mods=[]
M=m1*m2*m3
M_s=[]
m=0
for i in mods:
    M_s.append(M//i)
    inv_mods.append(inverse(M//i,i))
for i in range(3):
    m+=y[i]*inv_mods[i]*M_s[i]%M
m=m%M%p
print(long_to_bytes(m))
```

我之前学过怎么解[同余方程组](https://github.com/C0nstellati0n/NoobCTF/blob/main/%E7%AC%94%E8%AE%B0/Crypto/%E6%95%B0%E8%AE%BA%E5%AD%A6%E4%B9%A0.md#the-chinese-remainder-theorem)，感觉大佬的解法又熟悉又陌生。应该就是求逆元然后相乘，for循环里面每次都要模M以及最后要模M都是为了不让结果超出M。

## Flag
> flag{1sn't_s0_int3Resting}